#!/bin/bash

# Startupscript for iTop.
# Add the following env variables
# ITOPDOCKERRUN=~/web/itop-docker-run
# ITOPDOCKERCON=robban/dev

case "$1" in
        start)
            docker run -d -it -p 80:80 --net=host -h 127.0.0.1 \
            -v $ITOPDOCKERRUN/conf:/app/web/conf \
            -v $ITOPDOCKERRUN/data:/app/web/data \
            -v $ITOPDOCKERRUN/env-production:/app/web/env-production \
            -v $ITOPDOCKERRUN/log:/app/web/log \
            $ITOPDOCKERCON
            ;;
         
        stop)
            docker ps | grep $ITOPDOCKERCON | awk '{print $1}'| xargs docker stop
            ;;
         
        build)
            cd ~/PycharmProjects/itop-docker
            docker build -t $ITOPDOCKERCON .
            ;;
        restart)
            docker ps | grep $ITOPDOCKERCON | awk '{print $1}'| xargs docker restart
            ;;
        shell)
            DOCKERID=`docker ps | grep $ITOPDOCKERCON | awk '{print $1}'`
            docker exec -it $DOCKERID /bin/bash
            ;;
        config)
            DOCKERID=`docker ps | grep $ITOPDOCKERCON | awk '{print $1}'`
            docker exec -it $DOCKERID /scripts/make-itop-config-writable.sh
            ;;
        toolkit)
            DOCKERID=`docker ps | grep $ITOPDOCKERCON | awk '{print $1}'`
            docker exec -it $DOCKERID /scripts/install-toolkit.sh
            ;;
        status)
            docker ps
            ;;
         
        *)
            echo $"Usage: $0 {start|stop|restart|status}"
            exit 1
 
esac


